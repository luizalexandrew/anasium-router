<link rel="import" href="../polymer/polymer.html">

<script src="./route-recognizer.js"></script>
<!--
`anasium-router`


@demo demo/index.html
-->

<link rel="import" href="anasium-route.html">

<dom-module id="anasium-router">
  <script>
    class AnasiumRouter extends Polymer.Element {
      constructor() {
        super();
        this.router = new RouteRecognizer();
      }

      static get is() {
        return 'anasium-router';
      }

      static get properties() {
        return {
          route: Object
        };
      }

      ready() {
        super.ready();
        var routeElements = this.querySelectorAll('anasium-route');

        routeElements.forEach(function(routeElement) {
          this.addRoute(routeElement.route);
        }, this);
      }

      static get observers() {
        return [
          '_routeChanged(route)'
        ]
      }

      addRoute(route) {
        this.router.add([{
          path: route.path,
          handler: {
            name: route.name
          }
        }]);
      }

      _routeChanged(route) {
        if (route === undefined || route.path === undefined || route.path === "undefined") {
          // TODO fire event and may be go to the default page
        } else {
          var result = this.router.recognize(route.path);
          var mainHandler = result[0].handler;

          this.dispatchEvent(new CustomEvent('route-changed', {
            detail: {
              name: mainHandler.name,
              queryParams: result.queryParams
            }
          }));
        }
      }
    }

    window.customElements.define(AnasiumRouter.is, AnasiumRouter);
  </script>
</dom-module>
