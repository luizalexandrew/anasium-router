<link rel="import" href="../polymer/polymer.html">

<script src="./route-recognizer.js"></script>
<!--
`anasium-router`


@demo demo/index.html
-->

<link rel="import" href="anasium-route.html">

<dom-module id="anasium-router">
  <script>
    class AnasiumRouter extends Polymer.Element {
      constructor() {
        super();
        this.router = new RouteRecognizer();
      }

      static get is() {
        return 'anasium-router';
      }

      static get properties() {
        return {
          route: Object
        };
      }

      ready() {
        super.ready();
        var routeElements = this.querySelectorAll('anasium-route');

        routeElements.forEach(function(routeElement) {
          this.addRoute(routeElement.route);
        }, this);
      }

      static get observers() {
        return [
          '_routeChanged(route)'
        ]
      }

      addRoute(route) {
        this.router.add([{
          path: route.path,
          handler: {
            name: route.name
          }
        }]);
      }

      _routeChanged(route) {
        if (route === undefined || route.path === undefined || route.path === "undefined") {
          // TODO (event) fallback route ?
        } else {
          var _result = this.router.recognize(route.path);

          if (_result === undefined || _result === "undefined" || _result.length <= 0) {
            // TODO (event) fallback route ?
          } else {
            var result = _result[0];

            this.dispatchEvent(new CustomEvent('route-changed', {
              detail: {
                name: result.handler.name,
                route: this.route,
                params: result.params,
                queryParams: result.queryParams
              }
            }));
          }
        }
      }
    }

    window.customElements.define(AnasiumRouter.is, AnasiumRouter);
  </script>
</dom-module>
